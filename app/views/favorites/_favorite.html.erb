<% if user_signed_in? && can?(:favorite, @post) %>
  <% favorite = @post.favorite_for(current_user)  %>
  <% if favorite.present? %>
    <%= link_to 'unfavorite', favorite_path(favorite), remote: true, method: :delete %>
  <% else %>
    <%= link_to 'favorite', post_favorites_path(@post), remote: true, method: :post%>
  <% end %>
<% end %>
